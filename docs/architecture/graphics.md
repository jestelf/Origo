# Подсистема рендеринга

Документ описывает текущую реализацию минимального графического пайплайна
движка. На данном этапе используются `Python` и библиотека `ModernGL` для
работы с контекстом OpenGL.

## Инициализация

При создании экземпляра `Renderer` происходит попытка получить активный
контекст OpenGL. Если окно не создано (например, в модульных тестах),
движок инициализирует автономный контекст `EGL`.

Далее компилируются простые вершинный и фрагментный шейдеры. Вершинный
шейдер принимает позицию и цвет вершины, а также матрицу вида-проекции
(`u_mvp`).

## Камера

Класс `Camera` формирует матрицы перспективной проекции и вида. Камера
настраивается исходя из размеров окна, что позволяет корректно отображать
трёхмерные объекты.

## Загрузка моделей

Модели в формате OBJ располагаются в каталоге `assets/models`. За их
чтение отвечает `ModelManager`, который превращает вершины и индексы из
файла в массив `numpy`, подходящий для создания буфера.

## Цикл рендера

На каждом кадре `Renderer` очищает экран выбранным цветом, передаёт в
шейдер актуальную матрицу `MVP` и выводит загруженную модель при помощи
`vertex_array.render()`.

## Мобильная оптимизация

При запуске на мобильных устройствах активируется режим `mobile_mode`. Он
уменьшает разрешение текстур до 512 пикселей и отключает тяжёлые эффекты.
Ассеты предварительно конвертируются командой
`python scripts/maintenance/optimize_assets.py`.

## Проверка шейдеров

Все GLSL-файлы располагаются в каталоге `assets/shaders`. Для быстрой
валидации перед сборкой используется команда:

```bash
python -m origo_cli.runner validate-shaders
```

Скрипт перебирает `assets/shaders/*.glsl` и пытается скомпилировать каждый
файл. Если в системе доступен `glslangValidator`, он применяется в первую
очередь. В противном случае проверка выполняется через автономный
контекст `ModernGL`. В консоль выводится список успешно собранных и
проблемных шейдеров.
